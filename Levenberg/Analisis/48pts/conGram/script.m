%function script()
%Puntos seleccionados en pixeles
%imgPts y scnPts están en el orden original

imgPts = [837.8741455078125, 897.2778930664062, 956.9844360351562, 1016.42333984375, 1076.3017578125, 1136.21044921875, 832.9345092773438, 895.29541015625, 957.1570434570312, 1019.464172363281, 1081.859375, 1144.757080078125, 827.8035278320312, 892.4791870117188, 957.6625366210938, 1022.542297363281, 1087.906127929688, 1153.239379882812, 821.8426513671875, 890.1197509765625, 957.7943115234375, 1026.245727539062, 1094.3779296875, 1163.309936523438, 815.56787109375, 886.8239135742188, 958.4537963867188, 1029.955322265625, 1101.938354492188, 1174.005615234375, 808.3628540039062, 883.7537841796875, 958.714111328125, 1034.350463867188, 1109.638305664062, 1185.86376953125, 800.7138061523438, 879.9265747070312, 959.5117797851562, 1038.83056640625, 1118.88916015625, 1198.915893554688, 791.6714477539062, 875.909912109375, 959.8040771484375, 1044.343017578125, 1128.69677734375, 1214.092529296875;
  679.0939331054688, 676.92724609375, 674.5238647460938, 672.1847534179688, 670.0202026367188, 667.4046630859375, 703.5702514648438, 701.4966430664062, 699.173828125, 696.7796020507812, 694.4873657226562, 692.2327270507812, 729.8762817382812, 726.9873046875, 724.7837524414062, 722.2488403320312, 719.9083862304688, 717.5863647460938, 758.3207397460938, 754.8271484375, 752.7904052734375, 750.1862182617188, 747.7540283203125, 745.3524169921875, 789.2471313476562, 786.6021728515625, 783.5311279296875, 781.093505859375, 778.31787109375, 776.1768798828125, 824.7357177734375, 821.5552368164062, 818.5955810546875, 816.066162109375, 813.6526489257812, 811.060791015625, 864.3524169921875, 861.1209106445312, 858.2491455078125, 855.4376220703125, 853.0947265625, 850.376708984375, 908.6774291992188, 905.4671020507812, 902.0062255859375, 899.7337036132812, 896.8604736328125, 894.7748413085938;
  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1];
scnPts = [0, 0.119999997317791, 0.239999994635582, 0.3599999845027924, 0.4799999892711639, 0.5999999642372131, 0, 0.119999997317791, 0.239999994635582, 0.3599999845027924, 0.4799999892711639, 0.5999999642372131, 0, 0.119999997317791, 0.239999994635582, 0.3599999845027924, 0.4799999892711639, 0.5999999642372131, 0, 0.119999997317791, 0.239999994635582, 0.3599999845027924, 0.4799999892711639, 0.5999999642372131, 0, 0.119999997317791, 0.239999994635582, 0.3599999845027924, 0.4799999892711639, 0.5999999642372131, 0, 0.119999997317791, 0.239999994635582, 0.3599999845027924, 0.4799999892711639, 0.5999999642372131, 0, 0.119999997317791, 0.239999994635582, 0.3599999845027924, 0.4799999892711639, 0.5999999642372131, 0, 0.119999997317791, 0.239999994635582, 0.3599999845027924, 0.4799999892711639, 0.5999999642372131;
  0, 0, 0, 0, 0, 0, 0.119999997317791, 0.119999997317791, 0.119999997317791, 0.119999997317791, 0.119999997317791, 0.119999997317791, 0.239999994635582, 0.239999994635582, 0.239999994635582, 0.239999994635582, 0.239999994635582, 0.239999994635582, 0.3599999845027924, 0.3599999845027924, 0.3599999845027924, 0.3599999845027924, 0.3599999845027924, 0.3599999845027924, 0.4799999892711639, 0.4799999892711639, 0.4799999892711639, 0.4799999892711639, 0.4799999892711639, 0.4799999892711639, 0.5999999642372131, 0.5999999642372131, 0.5999999642372131, 0.5999999642372131, 0.5999999642372131, 0.5999999642372131, 0.7199999690055847, 0.7199999690055847, 0.7199999690055847, 0.7199999690055847, 0.7199999690055847, 0.7199999690055847, 0.8399999737739563, 0.8399999737739563, 0.8399999737739563, 0.8399999737739563, 0.8399999737739563, 0.8399999737739563;
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1];

K = [616.1640014648438, 0, 325.5280151367188;
  0, 616.8200073242188, 228.6600036621094;
  0, 0, 1];
  Kinv=inv(K);
  %se pasa a m
  imgPtsm=Kinv*imgPts;
  %La homografía es de scp a imp


  imp=[imgPts(1:2,:)];
  scp=[scnPts(1:2,:)];
  scp2=[scp;ones(1, size(imgPts,2)
)];

H=[0.7944980996608, -0.3552882991900599, 0.831954809746873;
  -0.03695065223268957, 0.05424549834400218, 0.7304964605198651;
  -0.008574659915334355, -0.3505543060177539, 1];
  mapeoIm=H*scp2;
  %mapeoIm2
  %Deshomog...
  for i=1: size(mapeoIm,2)
    mapeoIm(:,i)=mapeoIm(1:3,i)/mapeoIm(3,i);
  end
%Distancia entre los 2 conjuntos de puntos
temp=mapeoIm;
dist1=[];
  for i=1: size(mapeoIm,2)
    temp(1:3,i)=(mapeoIm(1:3,i)-imgPtsm(1:3,i));
    dist1(i)=norm(temp(:,i));
  end

Dummy = [1, 0, 0, 0;
  0, 1, 0, 0;
  0, 0, 1, 0];

%Con Gram.. sin optimizar
R= [0.9988622003599396, -0.005796216503213505, 0.04733612327121708;
  -0.04645525245389113, 0.1061149974512362, 0.9932680991733146;
  -0.01078026954882046, -0.9943369706443446, 0.105724995144397];
T= [1.04595368096989;
  0.9183977938040893;
  1.257224152941826];
%optimizado, deja de ser una matriz de rot
  #{
R=[-6.729139245820193e-09, 5.441527805693568e-09, 9.211222983316312e-09;
  -5.44152777513154e-09, -6.729139023775588e-09, -1.658956036205324e-09;
  -9.211223001370822e-09, 1.658955935959071e-09, -6.729139245820193e-09];
T=[2.692122831835242e-08;
  2.292504367157874e-08;
  3.318499127338523e-08];
  #}


G= [[R T]; [0, 0, 0, 1]];
  
  %Rotamos y trasladamos 12 los puntos establecidos del rectángulo
  scnPtsRot=K*Dummy*G*scnPts;
  %Calculamos el error
  temp2=scnPtsRot;
  dist2=[];
  for i=1: size(imgPts,2)
    %temp2(1:4,i)=(intersec(1:4,i)-scnPtsRot(1:4,i));
    temp2(1:3,i)=scnPtsRot(1:3,i)/scnPtsRot(3,i);
    %dist2(i)=norm(temp2(:,i));
  end
  %temp2=[temp2(1:3,:)];
  temp3=temp2;
  errorPix=temp3;
  for i=1:size(temp3,2)
    errorPix(1:3,i)=(imgPts(1:3,i)-temp3(1:3,i));
  end

  %Error en metros
  scnPtsRotm=Dummy*G*scnPts;
%scnPtsRotm=[scnPtsRotm(1:3,:)];
%Deshomoge...
  for i=1: size(scnPtsRotm,2)
    scnPtsRotm(1:3,i)=scnPtsRotm(1:3,i)/scnPtsRotm(3,i);
  end

  errorM=scnPtsRotm;
  for i=1:size(errorM,2)
    errorM(1:3,i)=(imgPtsm(1:3,i)-scnPtsRotm(1:3,i));
  end


  


%end
